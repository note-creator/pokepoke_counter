<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ポケポケ勝敗カウンター</title>
  <style>
    body {
      background-color: transparent;
      font-family: sans-serif;
      color: white;
    }
    #compactView {
      font-size: 32px;
      font-weight: bold;
      padding: 10px;
      color: white;
      background-color: rgba(0, 0, 0, 0); /* 完全透過 */
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7); /* 縁取り風の影 */
    }

    .section {
      margin-bottom: 10px;
    }
    button {
      font-size: 16px;
      margin: 5px;
      padding: 8px 12px;
    }
    input {
      font-size: 16px;
      padding: 5px;
    }
  </style>
</head>
<body>
  <h1>ポケポケ勝敗カウンター</h1>

  <div class="section">
    <label>初期ポイント: <input type="number" id="startPoint" value="1000"></label>
    <button onclick="setStartPoint()">設定</button>
  </div>

  <div class="section">
    <p id="currentPoint">現在のポイント: 1000</p>
    <p id="rankName">現在のランク: マスターボール</p>
    <p id="matchStats">対戦数: 0｜勝ち: 0｜負け: 0｜引き分け: 0｜勝率: 0%</p>
    <p id="streakStats">連勝数: 0｜最大連勝数: 0</p>
  </div>

  <div class="section">
    <p id="compactView">0勝 0敗 0分 0連勝 最大0連勝 0.0% 全0戦｜1000Pt（マスターボール）</p>
  </div>

  <div class="section">
    <button onclick="win()">勝ち</button>
    <button onclick="lose()">負け</button>
    <button onclick="draw()">引き分け</button>
    <button onclick="undo()">戻る</button>
  </div>
  <script>
    let point = 1000;
    let winStreak = 0;
    let maxStreak = 0;
    let wins = 0;
    let losses = 0;
    let draws = 0;
    let history = [];

    function setStartPoint() {
      point = parseInt(document.getElementById('startPoint').value);
      winStreak = 0;
      maxStreak = 0;
      wins = 0;
      losses = 0;
      draws = 0;
      history = [];
      updateDisplay();
    }

    function win() {
      saveHistory();
      winStreak++;
      if (winStreak > maxStreak) maxStreak = winStreak;
      let bonus = winStreak >= 2 ? (winStreak - 1) * 3 : 0;
      point += 10 + bonus;
      wins++;
      updateDisplay();
    }

    function lose() {
      saveHistory();
      const rank = getRankName(point);
      if (rank.startsWith("ビギナー")) {
        // no change
      } else if (rank.startsWith("モンスターボール") || rank.startsWith("スーパーボール")) {
        point -= 5;
      } else if (rank.startsWith("ハイパーボール")) {
        point -= 7;
      } else if (rank.startsWith("マスターボール")) {
        point -= 10;
      }
      winStreak = 0;
      point = Math.max(point, getRankMin(point));
      losses++;
      updateDisplay();
    }

    function draw() {
      saveHistory();
      winStreak = 0;
      draws++;
      updateDisplay();
    }

    function undo() {
      if (history.length > 0) {
        const last = history.pop();
        point = last.point;
        winStreak = last.winStreak;
        maxStreak = last.maxStreak;
        wins = last.wins;
        losses = last.losses;
        draws = last.draws;
        updateDisplay();
      }
    }

    function saveHistory() {
      history.push({
        point, winStreak, maxStreak, wins, losses, draws
      });
    }
    function updateDisplay() {
      const rank = getRankName(point);
      const total = wins + losses + draws;
      const winRate = (wins + losses > 0) ? (wins / (wins + losses) * 100).toFixed(1) : "0.0";
      document.getElementById('currentPoint').textContent = `現在のポイント: ${point}`;
      document.getElementById('rankName').textContent = `現在のランク: ${rank}`;
      document.getElementById('matchStats').textContent =
        `対戦数: ${total}｜勝ち: ${wins}｜負け: ${losses}｜引き分け: ${draws}｜勝率: ${winRate}%`;
      document.getElementById('streakStats').textContent =
        `連勝数: ${winStreak}｜最大連勝数: ${maxStreak}`;
      document.getElementById('compactView').textContent =
        `${wins}勝 ${losses}敗 ${draws}分 ${winStreak}連勝 最大${maxStreak}連勝 ${winRate}% 全${total}戦｜${point}Pt（${rank}）`;
    }

    function getRankName(p) {
      const ranks = [
        { name: "マスターボール", min: 1450 },
        { name: "ハイパーボール4", min: 1230 },
        { name: "ハイパーボール3", min: 1010 },
        { name: "ハイパーボール2", min: 860 },
        { name: "ハイパーボール1", min: 710 },
        { name: "スーパーボール4", min: 600 },
        { name: "スーパーボール3", min: 490 },
        { name: "スーパーボール2", min: 420 },
        { name: "スーパーボール1", min: 355 },
        { name: "モンスターボール4", min: 300 },
        { name: "モンスターボール3", min: 245 },
        { name: "モンスターボール2", min: 195 },
        { name: "モンスターボール1", min: 145 },
        { name: "ビギナー4", min: 95 },
        { name: "ビギナー3", min: 50 },
        { name: "ビギナー2", min: 20 },
        { name: "ビギナー1", min: 0 }
      ];
      for (let rank of ranks) {
        if (p >= rank.min) return rank.name;
      }
      return "ビギナー1";
    }

    function getRankMin(p) {
      const ranks = [
        { name: "マスターボール", min: 1450 },
        { name: "ハイパーボール4", min: 1230 },
        { name: "ハイパーボール3", min: 1010 },
        { name: "ハイパーボール2", min: 860 },
        { name: "ハイパーボール1", min: 710 },
        { name: "スーパーボール4", min: 600 },
        { name: "スーパーボール3", min: 490 },
        { name: "スーパーボール2", min: 420 },
        { name: "スーパーボール1", min: 355 },
        { name: "モンスターボール4", min: 300 },
        { name: "モンスターボール3", min: 245 },
        { name: "モンスターボール2", min: 195 },
        { name: "モンスターボール1", min: 145 },
        { name: "ビギナー4", min: 95 },
        { name: "ビギナー3", min: 50 },
        { name: "ビギナー2", min: 20 },
        { name: "ビギナー1", min: 0 }
      ];
      for (let rank of ranks) {
        if (p >= rank.min) return rank.min;
      }
      return 0;
    }

    updateDisplay(); // 初期表示
  </script>
</body>
</html>
